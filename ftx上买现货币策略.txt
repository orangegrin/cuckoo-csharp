游标价    --没有仓位时取bid1，当限价或止盈订单完全成交，取订单成交价              无条件开仓  开仓方向？现货   ， qty: (开仓已成交数量) 所有开仓数量？
初始价值 （需要配置），可能直接超过最大本金
已使用价值 （初始价值-已开仓价值）
开仓率：-0.03
止盈率：0.03
仓位率：0.03
限价开仓 =    price: 游标价 * （1 + 开仓率）	 qty:（初始价值-已使用价值）* 仓位率 
现价止盈 =    price: 开仓价 * (1 +止盈率 ) 		 qty: (开仓已成交数量)  当现价开仓订单未完全成交时，可能会开多个同一价格不同数量的订单  。。意思是会挂多个梯度的订单？

保存未平仓订单到数据库

问题合集：

止盈单肯定在开仓单之上

1 止盈 开仓价： 最后一笔订单开仓价格

2 限价开仓和 限价止盈同时进行？是

3 开仓只可能存在一个，而止盈可能有多个

4 如果开仓部分成交，价格回去了； 取消开仓订单

5 需要容错，可能仓位不够的情况

1判断平仓堆栈是否达到平仓条件，如果达到市价平仓并删除平仓堆栈本条数据
2判断是否达到开仓价格满足则开仓

3 判断有无仓位
	无：取消前面订单挂剩余数量订单 用bid1市价开仓数量（（初始价值-已使用价值）* 仓位率 ）
	有：用上一笔订单成交均价（现价或止盈订单完全成交价）设置平仓堆栈中加入平仓价格和上次开仓数量 （（初始价值-已使用价值）* 仓位率 ）->2


难点：

1 手续费导致，平仓数量不等于开仓数量


2 部分成交数量过于小，不够提交止盈订单数量

3 开仓订单部分成交，挂止盈订单部分成交，然后 开仓订单全部成交 ，直接止盈订单完全成交，在挂全部止盈订单之前

4 已经挂好的开仓单，在止盈订单成交 后取消重新挂开仓单，和开仓单对应的止盈单这时候应该成交了

5 被插针，多个止盈订单同时成交

6 由于插针完成的成交订单，价格高于当前 bid1，所以无法挂限价单

7 没有找到的已经成交的止盈订单，挂单时间过久，ftx的获取订单历史按照创建订单时间来排序的，成交完但是挂单早的订单就看不到了，只能根据订单id查找对应状态

8 开仓单也改成读取订单状态

9 使用钱改成读取“美元价值”

10 增加一个验证方法，当挂单完全成交的时候验证 可使用仓位数量如果大于最小数量那么，在下次挂单的时候加上

11 ftx最高挂单 50个，如果超过40个，那么把价格最高的止盈单，n个合成一个。

12 修改为，可以使用现货杠杆

13 检查orderbook错误

8*4 +18 +7

./Indicators -i 2103 -c ./ZigZag2_0confing3_eth_zigzag3.json  -r> ZigZag2_0confing3_eth_zigzag3_2103.log
./Indicators -i 2100 -c ./ZigZag2_0confing1_eth_fortest.json  -r> ZigZag2_0confing1_eth_fortest_2100.log

(balance("RUNE") * price("RUNE/USD") + position("RUNE-PERP")* price("RUNE-PERP"))/(9600*4.5)>0

000000
一共6位
第1位表示类型，1自己号，2客户号，3测试号
第2,3位表示币种类型，
456表示对应类型，对应币种 号下面的策略id




1 以前的所有出场进场逻辑删除

2 只保留zigzag的高低点开仓，高低点平仓逻辑

3 zigzag以前是以最新的高点点比较，现在改成和开仓时候的高点点比较

4 新增平仓逻辑  多仓： 当前价格< “出场价格” 就平仓。  空仓：当前价格> “出场价格” 就平仓

5 出场价格 = 本次开仓后的最高价格 - 2*波动率*开仓价格

6 波动率用高阳文档算，波动率的 周期单位小时，取n个小时

7 开仓头寸 = 资金量*参数a/（波动率*10*标的乘数*标的价格）




lxh22.

波动率 是绝对值的

